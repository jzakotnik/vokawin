generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum GameStatus {
  PENDING
  ACTIVE
  COMPLETED
  CANCELLED
}

model User {
  id                 Int                 @id @default(autoincrement())
  name               String
  email              String?             @unique
  // Ownership
  gameConfigurations GameConfiguration[]
  games              Game[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Vocabulary {
  id                 Int                 @id @default(autoincrement())
  source             String // e.g., book/course/source
  sourceLang         String
  targetLang         String
  sourceWord         String
  targetWord         String
  comment            String              @default("No comment")
  gameConfigurations GameConfiguration[] // many configs can reuse one list

  // Optional: quick search/indexes
  @@index([sourceLang, targetLang, sourceWord, targetWord, source])
}

model GameConfiguration {
  id           Int        @id @default(autoincrement())
  userId       Int
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  mode         Int        @default(0)
  name         String // e.g., "Speed round", "Unit 3 practice"
  vocabularyId Int
  vocabulary   Vocabulary @relation(fields: [vocabularyId], references: [id])

  // Range of entries by position (inclusive)
  startPosition Int
  endPosition   Int
  nrWords       Int //how many words out of the range

  games Game[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Prevent duplicate names per user (optional)
  @@unique([userId, name])
}

model Game {
  id     Int  @id @default(autoincrement())
  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  gameConfigurationId Int
  gameConfiguration   GameConfiguration @relation(fields: [gameConfigurationId], references: [id], onDelete: Cascade)

  accessCode String     @unique
  status     GameStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([gameConfigurationId])
  @@index([userId])
}
